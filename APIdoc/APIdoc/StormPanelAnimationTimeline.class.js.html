<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>StormEngineC 1.2 API DOC Source: StormPanelAnimationTimeline.class.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	
	<link type="text/css" rel="stylesheet" href="styles/site.stormenginec.css">
	
</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">StormEngineC 1.2 API DOC</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="StormBufferObject.html">StormBufferObject</a>
						</li>
						
						<li>
							<a href="StormCamera.html">StormCamera</a>
						</li>
						
						<li>
							<a href="StormEngineC.html">StormEngineC</a>
						</li>
						
						<li>
							<a href="StormEngineC_PanelAnimationTimeline.html">StormEngineC_PanelAnimationTimeline</a>
						</li>
						
						<li>
							<a href="StormForceField.html">StormForceField</a>
						</li>
						
						<li>
							<a href="StormGI.html">StormGI</a>
						</li>
						
						<li>
							<a href="StormGLContext.html">StormGLContext</a>
						</li>
						
						<li>
							<a href="StormGroupNodes.html">StormGroupNodes</a>
						</li>
						
						<li>
							<a href="StormLight.html">StormLight</a>
						</li>
						
						<li>
							<a href="StormLine.html">StormLine</a>
						</li>
						
						<li>
							<a href="StormLineSceneCollision.html">StormLineSceneCollision</a>
						</li>
						
						<li>
							<a href="StormM16.html">StormM16</a>
						</li>
						
						<li>
							<a href="StormMaterial.html">StormMaterial</a>
						</li>
						
						<li>
							<a href="StormNode.html">StormNode</a>
						</li>
						
						<li>
							<a href="StormParticles.html">StormParticles</a>
						</li>
						
						<li>
							<a href="StormPolarityPoint.html">StormPolarityPoint</a>
						</li>
						
						<li>
							<a href="StormTriangleBox.html">StormTriangleBox</a>
						</li>
						
						<li>
							<a href="StormUtils.html">StormUtils</a>
						</li>
						
						<li>
							<a href="StormV3.html">StormV3</a>
						</li>
						
						<li>
							<a href="StormVoxelizator.html">StormVoxelizator</a>
						</li>
						
						<li>
							<a href="WebCLGL.html">WebCLGL</a>
						</li>
						
						<li>
							<a href="WebCLGLBuffer.html">WebCLGLBuffer</a>
						</li>
						
						<li>
							<a href="WebCLGLKernel.html">WebCLGLKernel</a>
						</li>
						
						<li>
							<a href="WebCLGLUtils.html">WebCLGLUtils</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="global.html#$M16">$M16</a>
						</li>
						
						<li>
							<a href="global.html#$V3">$V3</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: StormPanelAnimationTimeline.class.js</h1>
    
    <section>
        <article>
            <pre class="sunlight-highlight-javascript linenums">/**
* @class
* @constructor

* @property {Int} start 
* @property {Int} end
*/
StormEngineC_PanelAnimationTimeline = function() {
	this.current = 0;
	this.start = 0;this.tempKeyFrameStart = 0;
	this.end = 25;
	
	this.SL = undefined;
	this.SLFrames = undefined;
	this.intervalPlay = undefined;
};

/**
* @type Void
* @private
*/
StormEngineC_PanelAnimationTimeline.prototype.loadPanel = function() {
	var html = '&lt;table id="HANDLEDRAG_StormPanelAnimationTimeline" style="width:100%;padding:0px 6px 0px 6px;border:0px;cursor:move;">'+
					'&lt;tr>'+
						'&lt;td style="width:120px;text-align:left;vertical-align:middle">'+
							"&lt;div id='INPUTID_StormPanelAnimationTimeline_current' style='width:100px;margin:auto;background-color:rgba(0,0,30,0.5);color:#AAA;text-align:center;' class='StormShadowInset StormRound'>&lt;/div>"+
						'&lt;/td>'+
						'&lt;td style="text-align:left;vertical-align:middle">'+
							"Start &lt;input id='INPUTID_StormPanelAnimationTimeline_start' type='text' value='"+this.start+"' style='width:100px;background-color:transparent;border:0;color:#FFF;text-align:center;' class='StormShadowInset' /> "+
							"End &lt;input id='INPUTID_StormPanelAnimationTimeline_end' type='text' value='"+this.end+"' style='width:100px;background-color:transparent;border:0;color:#FFF;text-align:center;' class='StormShadowInset' />"+
						'&lt;/td>'+
						'&lt;td style="text-align:left;vertical-align:middle">'+
							"&lt;button id='BUTTONID_StormPanelAnimationTimeline_key'>Set Key&lt;/button> "+
							"&lt;button id='BUTTONID_StormPanelAnimationTimeline_prev' class='SEC_PanelAnimation_control SEC_PanelAnimation_controlPrev'>&lt;/button>"+
							"&lt;button id='BUTTONID_StormPanelAnimationTimeline_play' class='SEC_PanelAnimation_control SEC_PanelAnimation_controlPlay'>&lt;/button>"+
							"&lt;button id='BUTTONID_StormPanelAnimationTimeline_stop' class='SEC_PanelAnimation_control SEC_PanelAnimation_controlStop'>&lt;/button>"+
							"&lt;button id='BUTTONID_StormPanelAnimationTimeline_next' class='SEC_PanelAnimation_control SEC_PanelAnimation_controlNext'>&lt;/button>"+
						'&lt;/td>'+
					'&lt;/tr>'+
				'&lt;/table>'+
				'&lt;div style="padding:6px" class="StormModalWindowInt StormRound">'+
					
					'&lt;div id="CANVASID_STORMANIMATIONTIMELINE_frames" style="height:10px;">&lt;/div>'+
					'&lt;div id="CANVASID_STORMANIMATIONTIMELINE_slider" class="StormShadowInset">&lt;canvas id="CANVASID_STORMANIMATIONTIMELINE" height="30">&lt;/canvas>&lt;/div>&lt;br />'+
					
				'&lt;/div>';
	
	var _this = this;
	stormEngineC.makePanel(_this, 'DIVID_StormPanelAnimationTimeline', 'TIMELINE', html);	
	
	
	
	
	
	
	$("#DIVID_StormPanelAnimationTimeline #INPUTID_StormPanelAnimationTimeline_start").bind('keyup', function() {
												stormEngineC.PanelAnimationTimeline.setStart($(this).val());
											});
	$("#DIVID_StormPanelAnimationTimeline #INPUTID_StormPanelAnimationTimeline_end").bind('keyup', function() {
												stormEngineC.PanelAnimationTimeline.setEnd($(this).val());
											});
											
	$('#CANVASID_STORMANIMATIONTIMELINE').attr('width', ($(document).width()-100));
	
	
	
	
	this.SL = $("#CANVASID_STORMANIMATIONTIMELINE_slider").slider({min: this.start,
														max: this.end,
														value: this.current}); 
	this.SL.slider({
		slide: function( event, ui ) {
			stormEngineC.PanelAnimationTimeline.setFrame(ui.value);
		}
	});
	
	
	this.drawTimelineGrid();
	
	
	
	
	$("#BUTTONID_StormPanelAnimationTimeline_key").bind('click', function() {
												if(stormEngineC.nearNode != undefined) {
													stormEngineC.nearNode.setAnimKey(stormEngineC.PanelAnimationTimeline.current);
												} else {
													alert('No object selected');
												}
											});
	$("#BUTTONID_StormPanelAnimationTimeline_prev").bind('click', function() {
												stormEngineC.PanelAnimationTimeline.prevFrame();
											});
	$("#BUTTONID_StormPanelAnimationTimeline_play").bind('click', function() {
												stormEngineC.PanelAnimationTimeline.play();
											});
	$("#BUTTONID_StormPanelAnimationTimeline_stop").bind('click', function() {
												stormEngineC.PanelAnimationTimeline.stop();
											});
	$("#BUTTONID_StormPanelAnimationTimeline_next").bind('click', function() {
												stormEngineC.PanelAnimationTimeline.nextFrame();
											});
};

/**
* @type Void
* @private
*/
StormEngineC_PanelAnimationTimeline.prototype.show = function() {
	$(".SECmenu").css('z-index','0');
	this.$.css('z-index','99').show(); 
};

/**
* Set the Global Timeline start
* @type Void
* @param {Int} frameStart
*/
StormEngineC_PanelAnimationTimeline.prototype.setStart = function(frame) {
	if(frame != '') {
		stormEngineC.PanelAnimationTimeline.start = frame;
		if(frame > stormEngineC.PanelAnimationTimeline.end) {
			$("#INPUTID_StormPanelAnimationTimeline_end").val(frame);
			stormEngineC.PanelAnimationTimeline.end = frame;
		}
		stormEngineC.PanelAnimationTimeline.drawTimelineGrid();
		$("#DIVID_StormPanelAnimationTimeline #INPUTID_StormPanelAnimationTimeline_start").val(frame);
	}
};

/**
* Set the Global Timeline end
* @type Void
* @param {Int} frameEnd
*/
StormEngineC_PanelAnimationTimeline.prototype.setEnd = function(frame) {
	if(frame != '') {
		stormEngineC.PanelAnimationTimeline.end = frame;
		if(frame &lt; stormEngineC.PanelAnimationTimeline.start) {
			$("#INPUTID_StormPanelAnimationTimeline_start").val(frame);
			stormEngineC.PanelAnimationTimeline.start = frame;
		}
		stormEngineC.PanelAnimationTimeline.drawTimelineGrid();
		$("#DIVID_StormPanelAnimationTimeline #INPUTID_StormPanelAnimationTimeline_end").val(frame);
	}
};

/**
* @type Void
* @private
* @param {Int} frame
*/
StormEngineC_PanelAnimationTimeline.prototype.setFrame = function(frame) {
	this.current = frame;
	this.applyAnimFrame(this.current);
	this.SL.slider("option", "value", parseInt(this.current));
};

/**
* @type Void
* @private
*/
StormEngineC_PanelAnimationTimeline.prototype.prevFrame = function() {
	this.current = (this.current &lt;= this.start) ? this.start : this.current-1;
	this.applyAnimFrame(this.current);
	this.SL.slider("option", "value", parseInt(this.current));
};

/**
* @type Void
* @private
*/
StormEngineC_PanelAnimationTimeline.prototype.nextFrame = function() {
	this.current = (this.current >= this.end) ? this.start : this.current+1;
	this.applyAnimFrame(this.current);
	this.SL.slider("option", "value", parseInt(this.current));
};

/**
* Play Global Timeline
* @type Void
*/
StormEngineC_PanelAnimationTimeline.prototype.play = function() {  
	if(this.intervalPlay == undefined) {
		this.intervalPlay = setInterval("stormEngineC.PanelAnimationTimeline.nextFrame();", 1000/25);
	}
};

/**
* Stop Global Timeline
* @type Void
*/
StormEngineC_PanelAnimationTimeline.prototype.stop = function() {
	if(this.intervalPlay != undefined) {
		clearInterval(this.intervalPlay);
		this.intervalPlay = undefined;
	}
};

/**
* @type Void
* @private
*/
StormEngineC_PanelAnimationTimeline.prototype.drawTimelineGrid = function() {	
	var divisorPixel = (1/(this.end-this.start));
	divisorPixel *= $('#CANVASID_STORMANIMATIONTIMELINE').attr('width');
	
	this.ctxAnimationTimeline = document.getElementById('CANVASID_STORMANIMATIONTIMELINE').getContext("2d");
	this.ctxAnimationTimeline.clearRect(0,0,$('#CANVASID_STORMANIMATIONTIMELINE').attr('width'),30);
	
	
	this.ctxAnimationTimeline.beginPath();
	this.ctxAnimationTimeline.lineWidth = 1;
	this.ctxAnimationTimeline.strokeStyle = 'rgba(255, 255, 255, 1.0)';
	makingLine = false;
	var aumentoDivisorPixel = 0;
	var currentFrame = this.start;
	var arrFrames = [];
	for(var n=0,f = $('#CANVASID_STORMANIMATIONTIMELINE').attr('width'); n &lt;= f; n++) {
		if(n == Math.round(aumentoDivisorPixel)) {
			makingLine = true;
			this.ctxAnimationTimeline.moveTo(n, 15);
			this.ctxAnimationTimeline.lineTo(n, 0);
			this.ctxAnimationTimeline.stroke();
			
			
		} else if(makingLine == true) {
			if(stormEngineC.nearNode != undefined) {
				if(stormEngineC.nearNode.nodePivot == undefined) {
					if(stormEngineC.nearNode.animWMatrix != undefined &amp;&amp; stormEngineC.nearNode.animWMatrix[currentFrame] != undefined) {
						arrFrames.push(currentFrame);
					}
				} else {
					if(stormEngineC.nearNode.animWMatrix != undefined &amp;&amp; stormEngineC.nearNode.nodePivot.animWMatrix[currentFrame] != undefined) {
						arrFrames.push(currentFrame);
					}
				}
			} 
			this.ctxAnimationTimeline.strokeText(currentFrame, (n-6), 30);
			
			currentFrame++;
			makingLine = false;
			aumentoDivisorPixel += divisorPixel;
		}
	}
	if(stormEngineC.nearNode != undefined) {
		if(stormEngineC.nearNode.nodePivot == undefined) {
			if(stormEngineC.nearNode.animWMatrix != undefined &amp;&amp; stormEngineC.nearNode.animWMatrix[currentFrame] != undefined) {
				arrFrames.push(currentFrame);
			}
		} else {
			if(stormEngineC.nearNode.animWMatrix != undefined &amp;&amp; stormEngineC.nearNode.nodePivot.animWMatrix[currentFrame] != undefined) {
				arrFrames.push(currentFrame);
			}
		}
	} 
	this.ctxAnimationTimeline.strokeText(currentFrame, (n-6), 30);
	
	
	
	
	
	
	if((this.current &lt; this.start) || (this.current > this.end)) this.current = parseInt(this.start);
	this.SL.slider("option", "min", parseInt(this.start));
	this.SL.slider("option", "max", parseInt(this.end));
	this.SL.slider("option", "value", parseInt(this.current));
	
	
	if(this.SLFrames != undefined) {
		this.SLFrames.slider("destroy");
		this.SLFrames = undefined;
	}
	if(arrFrames.length > 0) {
		this.SLFrames = $("#CANVASID_STORMANIMATIONTIMELINE_frames").slider({min: this.start,
															max: this.end,
															values: arrFrames}); 
		$("#CANVASID_STORMANIMATIONTIMELINE_frames").removeClass('ui-widget-content');
		$("#CANVASID_STORMANIMATIONTIMELINE_frames a").removeClass('ui-state-default ui-corner-all').css({'margin-left':'-0.4%',
																							'width':'10px',
																							'background-color':'#FF0000'});
		this.SLFrames.slider({
			slide: function( event, ui ) {
				$("#CANVASID_STORMANIMATIONTIMELINE_frames a").removeClass('ui-state-focus ui-state-active ui-state-hover').css({'background-color':'#FF0000'});
			},
			start: function( event, ui ) {
				stormEngineC.PanelAnimationTimeline.tempKeyFrameStart = ui.value;
				$("#CANVASID_STORMANIMATIONTIMELINE_frames a").removeClass('ui-state-focus ui-state-active ui-state-hover').css({'background-color':'#FF0000'});
			},
			stop: function( event, ui ) {
				stormEngineC.nearNode.changeAnimKey(stormEngineC.PanelAnimationTimeline.tempKeyFrameStart, ui.value);
				$("#CANVASID_STORMANIMATIONTIMELINE_frames a").removeClass('ui-state-focus ui-state-active ui-state-hover').css({'background-color':'#FF0000'});
			}
		});
		$("#CANVASID_STORMANIMATIONTIMELINE_frames a").bind('mouseover', function() {
													$(this).removeClass('ui-state-focus ui-state-active ui-state-hover').css({'background-color':'#FF0000'});
												});
		
	}
};

/**
* Apply anim matrixs to all scene nodes
* @type Void
* @private
* @param {Int} frame 
*/
StormEngineC_PanelAnimationTimeline.prototype.applyAnimFrame = function(frame) {
	$('#INPUTID_StormPanelAnimationTimeline_current').html(frame);
	this.current = frame;
	stormEngineC.runningAnim = true;
	// objetos
	for(n = 0, f = stormEngineC.nodes.length; n &lt; f; n++) {
		if(stormEngineC.nodes[n].animMin != undefined) { // existe animación
			if(stormEngineC.nodes[n].animController == 'GlobalTimeline') {
				var jsonM = this.getNodeMatrixForFrame(stormEngineC.nodes[n], this.current);
				stormEngineC.nodes[n].MPOS = jsonM.vec;
			}
		}
	}
	// lights
	for(n = 0, f = stormEngineC.lights.length; n &lt; f; n++) {
		if(stormEngineC.lights[n].animMin != undefined) { // existe animación
			if(stormEngineC.lights[n].animController == 'GlobalTimeline') {
				var jsonM = this.getNodeMatrixForFrame(stormEngineC.lights[n], this.current);
				stormEngineC.lights[n].MPOS = jsonM.vec;
				stormEngineC.lights[n].nodeCtxWebGL.MPOS = jsonM.vec.inverse();
			}
		}
	}
	// cámaras
	for(n = 0, f = stormEngineC.nodesCam.length; n &lt; f; n++) {
		if(stormEngineC.nodesCam[n].animMin != undefined) { // existe animación
			if(stormEngineC.nodesCam[n].animController == 'GlobalTimeline') { 
				var jsonM = this.getNodeMatrixForFrame(stormEngineC.nodesCam[n], this.current);
				stormEngineC.nodesCam[n].nodePivot.MPOS = jsonM.vec;
				stormEngineC.nodesCam[n].nodeGoal.MPOS = jsonM.vecb;
			}
		}
	}
	
};
 
/**
* Get the matrix for a node in a desired frame
* @type Void
* @private
* @param {StormNode} node
* @param {Int} frameNumber
*/
StormEngineC_PanelAnimationTimeline.prototype.getNodeMatrixForFrame = function(node, frame) { 
	
	if(node.animMin != undefined) { // animation exists
			
			if(node.nodePivot == undefined) { // objects and lights
				if(node.animWMatrix[frame] != undefined) {
					return {'vec':$M16(node.animWMatrix[frame].e)};
				} else {
					for(var nb = frame, fnb = this.start; nb >= fnb; nb--) {
						if(node.animWMatrix[nb] != undefined) {
							var prevFrame = nb;	break;
						}
					}
					for(var nb = frame, fnb = this.end; nb &lt;= fnb; nb++) {
						if(node.animWMatrix[nb] != undefined) {
							var nextFrame = nb;	break;
						}
					}
					if(prevFrame == undefined) return {'vec':$M16(node.animWMatrix[nextFrame].e)};
					if(nextFrame == undefined) return {'vec':$M16(node.animWMatrix[prevFrame].e)};
					
					
					var unitPosPrevNext = (nextFrame-frame)/(nextFrame-prevFrame);
					var pivotPrevFrameWMatrix = node.animWMatrix[prevFrame].e; var ppM = pivotPrevFrameWMatrix;
					var pivotNextFrameWMatrix = node.animWMatrix[nextFrame].e; var pnM = pivotNextFrameWMatrix;
					var arrWMatrix = [];
					var tt;
					arrWMatrix[0] = pnM[0]-((pnM[0]-ppM[0])*unitPosPrevNext);
					arrWMatrix[1] = pnM[1]-((pnM[1]-ppM[1])*unitPosPrevNext);
					arrWMatrix[2] = pnM[2]-((pnM[2]-ppM[2])*unitPosPrevNext);
					arrWMatrix[3] = pnM[3]-((pnM[3]-ppM[3])*unitPosPrevNext);
					arrWMatrix[4] = pnM[4]-((pnM[4]-ppM[4])*unitPosPrevNext);
					arrWMatrix[5] = pnM[5]-((pnM[5]-ppM[5])*unitPosPrevNext);
					arrWMatrix[6] = pnM[6]-((pnM[6]-ppM[6])*unitPosPrevNext);
					arrWMatrix[7] = pnM[7]-((pnM[7]-ppM[7])*unitPosPrevNext);
					arrWMatrix[8] = pnM[8]-((pnM[8]-ppM[8])*unitPosPrevNext);
					arrWMatrix[9] = pnM[9]-((pnM[9]-ppM[9])*unitPosPrevNext);
					arrWMatrix[10] = pnM[10]-((pnM[10]-ppM[10])*unitPosPrevNext);
					arrWMatrix[11] = pnM[11]-((pnM[11]-ppM[11])*unitPosPrevNext);
					arrWMatrix[12] = pnM[12]-((pnM[12]-ppM[12])*unitPosPrevNext);
					arrWMatrix[13] = pnM[13]-((pnM[13]-ppM[13])*unitPosPrevNext);
					arrWMatrix[14] = pnM[14]-((pnM[14]-ppM[14])*unitPosPrevNext);
					arrWMatrix[15] = pnM[15]-((pnM[15]-ppM[15])*unitPosPrevNext);
					return {'vec':$M16(arrWMatrix)};
				}
			} else { // cámaras
				if(node.nodePivot.animWMatrix[frame] != undefined) {
					return {'vec':$M16(node.nodePivot.animWMatrix[frame].e),'vecb':$M16(node.nodeGoal.animWMatrix[frame].e)};
				} else {
					for(var nb = frame, fnb = this.start; nb >= fnb; nb--) {
						if(node.nodePivot.animWMatrix[nb] != undefined) {
							var prevFrame = nb;	break;
						}
					}
					for(var nb = frame, fnb = this.end; nb &lt;= fnb; nb++) {
						if(node.nodePivot.animWMatrix[nb] != undefined) {
							var nextFrame = nb;	break;
						}
					}
					if(prevFrame == undefined) return {'vec':$M16(node.nodePivot.animWMatrix[nextFrame].e),'vecb':$M16(node.nodeGoal.animWMatrix[nextFrame].e)};
					if(nextFrame == undefined) return {'vec':$M16(node.nodePivot.animWMatrix[prevFrame].e),'vecb':$M16(node.nodeGoal.animWMatrix[prevFrame].e)};
					
					
					var unitPosPrevNext = (nextFrame-frame)/(nextFrame-prevFrame);
					var pivotPrevFrameWMatrix = node.nodePivot.animWMatrix[prevFrame].e; var ppM = pivotPrevFrameWMatrix;
					var pivotNextFrameWMatrix = node.nodePivot.animWMatrix[nextFrame].e; var pnM = pivotNextFrameWMatrix;
					var arrPivotWMatrix = [];
					var tt;
					arrPivotWMatrix[0] = pnM[0]-((pnM[0]-ppM[0])*unitPosPrevNext);
					arrPivotWMatrix[1] = pnM[1]-((pnM[1]-ppM[1])*unitPosPrevNext);
					arrPivotWMatrix[2] = pnM[2]-((pnM[2]-ppM[2])*unitPosPrevNext);
					arrPivotWMatrix[3] = pnM[3]-((pnM[3]-ppM[3])*unitPosPrevNext);
					arrPivotWMatrix[4] = pnM[4]-((pnM[4]-ppM[4])*unitPosPrevNext);
					arrPivotWMatrix[5] = pnM[5]-((pnM[5]-ppM[5])*unitPosPrevNext);
					arrPivotWMatrix[6] = pnM[6]-((pnM[6]-ppM[6])*unitPosPrevNext);
					arrPivotWMatrix[7] = pnM[7]-((pnM[7]-ppM[7])*unitPosPrevNext);
					arrPivotWMatrix[8] = pnM[8]-((pnM[8]-ppM[8])*unitPosPrevNext);
					arrPivotWMatrix[9] = pnM[9]-((pnM[9]-ppM[9])*unitPosPrevNext);
					arrPivotWMatrix[10] = pnM[10]-((pnM[10]-ppM[10])*unitPosPrevNext);
					arrPivotWMatrix[11] = pnM[11]-((pnM[11]-ppM[11])*unitPosPrevNext);
					arrPivotWMatrix[12] = pnM[12]-((pnM[12]-ppM[12])*unitPosPrevNext);
					arrPivotWMatrix[13] = pnM[13]-((pnM[13]-ppM[13])*unitPosPrevNext);
					arrPivotWMatrix[14] = pnM[14]-((pnM[14]-ppM[14])*unitPosPrevNext);
					arrPivotWMatrix[15] = pnM[15]-((pnM[15]-ppM[15])*unitPosPrevNext);
					
					var goalPrevFrameWMatrix = node.nodeGoal.animWMatrix[prevFrame].e; var gpM = goalPrevFrameWMatrix;
					var goalNextFrameWMatrix = node.nodeGoal.animWMatrix[nextFrame].e; var gnM = goalNextFrameWMatrix;
					var arrGoalWMatrix = [];
					arrGoalWMatrix[0] = gnM[0]-((gnM[0]-gpM[0])*unitPosPrevNext);
					arrGoalWMatrix[1] = gnM[1]-((gnM[1]-gpM[1])*unitPosPrevNext);
					arrGoalWMatrix[2] = gnM[2]-((gnM[2]-gpM[2])*unitPosPrevNext);
					arrGoalWMatrix[3] = gnM[3]-((gnM[3]-gpM[3])*unitPosPrevNext);
					arrGoalWMatrix[4] = gnM[4]-((gnM[4]-gpM[4])*unitPosPrevNext);
					arrGoalWMatrix[5] = gnM[5]-((gnM[5]-gpM[5])*unitPosPrevNext);
					arrGoalWMatrix[6] = gnM[6]-((gnM[6]-gpM[6])*unitPosPrevNext);
					arrGoalWMatrix[7] = gnM[7]-((gnM[7]-gpM[7])*unitPosPrevNext);
					arrGoalWMatrix[8] = gnM[8]-((gnM[8]-gpM[8])*unitPosPrevNext);
					arrGoalWMatrix[9] = gnM[9]-((gnM[9]-gpM[9])*unitPosPrevNext);
					arrGoalWMatrix[10] = gnM[10]-((gnM[10]-gpM[10])*unitPosPrevNext);
					arrGoalWMatrix[11] = gnM[11]-((gnM[11]-gpM[11])*unitPosPrevNext);
					arrGoalWMatrix[12] = gnM[12]-((gnM[12]-gpM[12])*unitPosPrevNext);
					arrGoalWMatrix[13] = gnM[13]-((gnM[13]-gpM[13])*unitPosPrevNext);
					arrGoalWMatrix[14] = gnM[14]-((gnM[14]-gpM[14])*unitPosPrevNext);
					arrGoalWMatrix[15] = gnM[15]-((gnM[15]-gpM[15])*unitPosPrevNext);
					
					return {'vec':$M16(arrPivotWMatrix),'vecb':$M16(arrGoalWMatrix)};
				}
			}
			
		
	} else {
		if(node.nodePivot == undefined) { // objects and lights
			return {'vec':$M16(node.MPOS.e)};
		} else { // cámaras
			return {'vec':$M16(node.nodePivot.MPOS.e),'vecb':$M16(node.nodeGoal.MPOS.e)};
		}
	}
		
};
</pre>
        </article>
    </section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					StormEngineC 1.2 API DOC
					<br />
					
					
		<span class="copyright">
		2010 Roberto Gonzalez. http://stormcolour.appspot.com
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha2</a>
		on Sun Sep 20 2015 23:11:11 GMT+0200 (CEST) using the <a href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<script src="scripts/sunlight.js"></script>
	<script src="scripts/sunlight.javascript.js"></script>
	<script src="scripts/sunlight-plugin.doclinks.js"></script>
	<script src="scripts/sunlight-plugin.linenumbers.js"></script>
	<script src="scripts/sunlight-plugin.menu.js"></script>
	<script src="scripts/jquery.min.js"></script>
	<script src="scripts/jquery.scrollTo.js"></script>
	<script src="scripts/jquery.localScroll.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>


	<script>  Sunlight.highlightAll({lineNumbers:true,  showMenu: true, enableDoclinks :true}); </script>

	<script>
		$( function () {
			$( "#toc" ).toc( {
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : 60
			} );
			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );

		} );
	</script>

	
	<script>
		$( function () {
			$('#main').localScroll({
				offset: { top: 56 } //offset by the height of your header (give or take a few px, see what works for you)
			});
			$( "dt h4.name" ).each( function () {
				var $this = $( this );
				var icon = $( "<i/>" ).addClass( "icon-plus-sign" ).addClass( "pull-right" ).addClass( "icon-white" );
				var dt = $this.parents( "dt" );
				var children = dt.next( "dd" );

				$this.append( icon ).css( {cursor : "pointer"} );
				$this.addClass( "member-collapsed" ).addClass( "member" );

				children.hide();
				$this.toggle( function () {
					icon.addClass( "icon-minus-sign" ).removeClass( "icon-plus-sign" ).removeClass( "icon-white" );
					$this.addClass( "member-open" ).removeClass( "member-collapsed" );
					children.slideDown();
				}, function () {
					icon.addClass( "icon-plus-sign" ).removeClass( "icon-minus-sign" ).addClass( "icon-white" );
					$this.addClass( "member-collapsed" ).removeClass( "member-open" );
					children.slideUp();
				} );
			} );
		} );
	</script>
	

</body>
</html>
